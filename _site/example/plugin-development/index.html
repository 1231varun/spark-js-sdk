<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Plugin Development</title>
  <meta name="description" content="External Dependencies">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
  <link rel="stylesheet" href="/spark-js-sdk/css/main.css">

  <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

  <link rel="canonical" href="ciscospark.github.io/spark-js-sdk/spark-js-sdk/example/plugin-development/">
  <link rel="alternate" type="application/rss+xml" title="Cisco Spark JavaScript SDK" href="ciscospark.github.io/spark-js-sdk/spark-js-sdk/feed.xml">
</head>


  <body>

    <header class="navbar navbar-static-top" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#primary-navigation" aria-controls="primary-navigation" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/spark-js-sdk/" class="navbar-brand">Cisco Spark JavaScript SDK</a>
    </div>
    <nav class="collapse navbar-collapse" id="primary-navigation">
      <ul class="nav navbar-nav">
        
          
          <li>
            <a class="page-link" href="/spark-js-sdk/api/">API</a>
          </li>
          
        
          
        
          
        
        <li>
          <a class="page-link" href="/spark-js-sdk/app">Example App</a>
        </li>
      </ul>
    </nav>
  </div>
</header>


    <main>
      <div class="container">
  <div class="row">
    <div class="col-xs-3">
      <ul class="nav">
        
          <li class="">
            <a href="/spark-js-sdk/example/getting-started/">Getting Started</a>
          </li>
        
          <li class="">
            <a href="/spark-js-sdk/example/browsers/">Usage in Browsers</a>
          </li>
        
          <li class="">
            <a href="/spark-js-sdk/example/calling/">Placing a Call</a>
          </li>
        
          <li class="">
            <a href="/spark-js-sdk/example/servers/">Usage in Node</a>
          </li>
        
          <li class=" active">
            <a href="/spark-js-sdk/example/plugin-development/">Plugin Development</a>
          </li>
        
          <li class="">
            <a href="/spark-js-sdk/example/storage-layer/">Storage Layer</a>
          </li>
        
      </ul>
    </div>
    <div class="col-xs-9">
      <article class="example" itemscope itemtype="http://schema.org/Article">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Plugin Development</h1>
    <p class="post-meta"></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h1 id="external-dependencies">External Dependencies</h1>

<ul>
  <li>You’ll need node 4 or later (We use <a href="https://github.com/creationix/nvm">nvm</a> but there are numerous options available for getting the right node version)</li>
  <li>Depending on what you’re working on, you’ll need <a href="http://www.graphicsmagick.org/">graphicsmagick</a></li>
</ul>

<h1 id="get-the-code-and-build-the-sdk">Get the code and build the SDK</h1>

<ol>
  <li>Fork the sdk on github.com.</li>
  <li>Clone your fork</li>
</ol>

<p><code class="highlighter-rouge">bash
  git clone git@github.com:&lt;YOUR GITHUB USERNAME&gt;/spark-js-sdk.git
 </code></p>

<ol>
  <li>Set up the upstream remote</li>
</ol>

<p><code class="highlighter-rouge">bash
  git remote add upstream git@github.com:ciscospark/spark-js-sdk.git
  git fetch upstream
 </code></p>

<ol>
  <li>Configure master to track and rebase from upstream</li>
</ol>

<p><code class="highlighter-rouge">bash
  git checkout master
  git branch --set-upstream-to upstream/master
  git config branch.master.rebase true
 </code></p>

<ol>
  <li>Install dependencies and build packages</li>
</ol>

<p>In order to interact with test users, we need a module that is not publicly available, so point at the internal npm registry during install. Unless you completely blow away your node modules directory, you won’t need to worry about this again. (Yes, this means that, for now, you’ll need to be on a cisco network to setup your development environment)</p>

<p><code class="highlighter-rouge">bash
  export NPM_CONFIG_REGISTRY=http://engci-maven-master.cisco.com/artifactory/api/npm/webex-npm-group
  npm install
  npm run bootstrap
  npm run build
 </code></p>

<ol>
  <li>Link the yeoman generator
  The sdk ships with a yeoman generator to aid in getting your plugin started. In order to stay in sync with the current preferred layout, use the generator that ships with the sdk rather than the one published to npm.</li>
</ol>

<p><code class="highlighter-rouge">bash
  cd packages/generator-ciscospark
  npm link
 </code></p>

<ol>
  <li>Install the <code class="highlighter-rouge">yo</code> cli tool</li>
</ol>

<p><code class="highlighter-rouge">bash
  npm install -g yo
 </code></p>

<h1 id="creating-your-plugin">Creating your plugin</h1>

<p>Now that you’ve got your environment set up, adding a new plugin is as simple as</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>yo ciscospark:plugin plugin-PLUGINNAME
</code></pre>
</div>

<blockquote>
  <p>If you’re creating a new sdk package that’s not intended to be a plugin (e.g helper-html), you can use
<code class="highlighter-rouge">bash
yo ciscospark:package PACKAGENAME
</code></p>
</blockquote>

<p>You’ll get a new folder in <code class="highlighter-rouge">/packages</code> with eslint files in the right place, a <code class="highlighter-rouge">package.json</code> with the bare minimum to create a plugin, some scaffolding for your test directory, and just enough files for your plugin to load and do nothing.</p>

<h2 id="plugin-structure">Plugin Structure</h2>

<p>./src - source code
./test/unit/spec - unit tests
./test/integration/spec - integration tests
./test/automation/spec - automation tests</p>

<h2 id="useful-commands">Useful Commands</h2>

<p>In order to minimize duplicate dependencies and lots of directory switching, all commands can (and should) be run from the sdk root directory.</p>

<h3 id="build">Build</h3>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nv">PACKAGE</span><span class="o">=</span>PACKAGENAME npm run grunt:package -- build
</code></pre>
</div>

<h3 id="run-tests">Run tests</h3>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nv">PACKAGE</span><span class="o">=</span>PACKAGENAME npm run grunt:package -- <span class="nb">test</span>
</code></pre>
</div>

<h3 id="run-just-unit-tests">Run just unit tests</h3>
<p>Handy during early plugin development when you can write a bunch of unit tests.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nv">UNIT_ONLY</span><span class="o">=</span><span class="nb">true </span><span class="nv">PACKAGE</span><span class="o">=</span>PACKAGENAME npm run grunt:package -- <span class="nb">test</span>
</code></pre>
</div>

<h3 id="run-the-tests-but-only-in-nodejs">Run the tests, but only in nodejs</h3>
<p>Usually faster, and can build on the fly, thus no need to rebuild everything between test runs</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nv">PACKAGE</span><span class="o">=</span>PACKAGENAME npm run grunt:package -- express:test <span class="nb">test</span>:node
</code></pre>
</div>

<h3 id="run-tests-in-browser-in-debug-mode">Run tests in-browser in debug mode</h3>
<p>Keeps the browser open so that you can reload set break points and reload the page</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nv">KARMA_DEBUG</span><span class="o">=</span><span class="nb">true </span><span class="nv">PACKAGE</span><span class="o">=</span>PACKAGENAME npm run grunt:package -- express:test <span class="nb">test</span>:browser
</code></pre>
</div>

<h3 id="serve-the-package">Serve the package</h3>
<p>This is mostly useful for the the example app(s), but also comes in handy when debugging the credentials plugins automation tests.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nv">PACKAGE</span><span class="o">=</span>PACKAGENAME npm run grunt:package -- serve
</code></pre>
</div>

<h3 id="run-unit-tests-in-watch-mode">Run unit tests in watch mode</h3>

<p>OK, this one’s a handfull and requires a global package, but there were too many possible variants to hardcode it any where.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>npm install -g nodemon
nodemon -w packages/PACKAGENAME/src -w packages/PACKAGENAME/test -x <span class="s2">"UNIT_ONLY=true PACKAGE=PACKAGENAME npm run --silent grunt:package express:test test:node"</span>
</code></pre>
</div>

<h2 id="tips">Tips</h2>
<ul>
  <li>During development, you can avoid rebuilding before each test run by replacing <code class="highlighter-rouge">"main": "dist/index.js"</code> with <code class="highlighter-rouge">"main": "src/index.js"</code> in <code class="highlighter-rouge">packages/*/package.json</code>. This won’t quite work in Karma, but if you apply the same replacement to <em>only</em> the package under test, that package will recompile on change; other packages will need to be rebuilt.</li>
  <li>If your git history has a comment containing <code class="highlighter-rouge">#no-push</code>, you can push to jenkins, run all your tests, and see the result without merging to master.</li>
  <li>CircleCI runs static-analysis and unit tests on every PR update.</li>
</ul>

  </div>

</article>

    </div>
</div>

    </main>

    <footer>
  <p class="copyright-block">© 2016 Cisco and/or its affiliates. All Rights Reserved.</p>
</footer>


  </body>

</html>
