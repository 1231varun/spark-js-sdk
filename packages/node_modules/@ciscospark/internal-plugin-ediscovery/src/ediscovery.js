/* eslint-disable prefer-template */
/*!
 * Copyright (c) 2015-2017 Cisco Systems, Inc. See LICENSE file.
 */

import {waitForValue, SparkPlugin} from '@ciscospark/spark-core';

import reportRequest from './report-request';

const Ediscovery = SparkPlugin.extend({
  namespace: 'Ediscovery',

  @waitForValue('@')
  createReport(userIds, keywords, spaceNames, spaceIds, range) {
    const body = reportRequest;
    body.userIds = userIds;
    body.keywords = keywords;
    body.spaceNames = spaceNames;
    body.spaceIds = spaceIds;
    body.range = range;

    return this.request({
      method: 'POST',
      service: 'ediscovery',
      resource: 'report',
      body
    }).then((res) => {
      console.log(res);
      this._processCreateReportSuccess(res);
    }).catch((reason) => {
      console.log(reason);
      return reason;
      // Normal behaviour
      //return Promise.reject(reason);
    });
  },

  _processCreateReportSuccess(res) {
    this.set(res.body);
    console.log('CreateReport response body set');
  },

  @waitForValue('@')
  getReports() {
    return this.request({
      method: 'GET',
      service: 'ediscovery',
      resource: 'reports'
    }).then((res) => {
      console.log(res);
      this._processGetReportsSuccess(res);
    }).catch((reason) => {
      console.log(reason);
      return reason;
      // Normal behaviour
      //return Promise.reject(reason);
    });
  },

  _processGetReportsSuccess(res) {
    this.set(res.body);
    console.log('GetReports response body set');
  }
});


export default Ediscovery;
