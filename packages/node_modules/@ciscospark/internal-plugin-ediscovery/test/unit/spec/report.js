import Ediscovery from '@ciscospark/internal-plugin-ediscovery';
import MockSpark from '@ciscospark/test-helper-mock-spark';
import sinon from '@ciscospark/test-helper-sinon/src/index';
import {expect} from '@ciscospark/test-helper-chai';

describe('Ediscovery API Tests', () => {
  let spark;
  const url = 'https://ediscovery-test.wbx2.com/ediscovery';
  const uuid = 'cc06f622-46ab-45b9-b3a6-5d70bad1d70a';

  beforeEach(() => {
    spark = new MockSpark({
      children: {
        ediscovery: Ediscovery
      }
    });
    spark.internal.device.getServiceUrl = sinon.stub().returns(Promise.resolve(url));
  });

  describe('Create Report Tests', () => {
    it('createReportSuccess', async () => {
      const result = spark.internal.ediscovery.createReport([], [], [], [], '').then((res) => {
        expect(res.statusCode).to.equal(200);
      });
      return result;
    });

    it('createReportWithNoParamFailure', async () => {
      const result = expect(spark.internal.ediscovery.createReport()).to.be.rejectedWith(Error, 'Invalid parameter(s)');
      return result;
    });
  });

  describe('Get Reports Tests', () => {
    it('getReportsSuccess', async () => {
      const result = spark.internal.ediscovery.getReports().then((res) => {
        expect(res.statusCode).to.equal(200);
      });
      return result;
    });
  });

  describe('Get Report Tests', () => {
    it('getReportSuccess', async () => {
      const result = spark.internal.ediscovery.getReport(uuid).then((res) => {
        expect(res.statusCode).to.equal(200);
      });
      return result;
    });

    it('getReportWithNoParamFailure', async () => {
      const result = expect(spark.internal.ediscovery.getReport()).to.be.rejectedWith(Error, 'Invalid parameter(s)');
      return result;
    });
  });

  describe('Delete Report Tests', () => {
    it('deleteReportSuccess', async () => {
      const result = spark.internal.ediscovery.deleteReport(uuid).then((res) => {
        expect(res.statusCode).to.equal(200);
      });
      return result;
    });

    it('deleteReportWithNoParamFailure', async () => {
      const result = expect(spark.internal.ediscovery.deleteReport()).to.be.rejectedWith(Error, 'Invalid parameter(s)');
      return result;
    });
  });

  describe('Restart Report Tests', () => {
    it('restartReportSuccess', async () => {
      const result = spark.internal.ediscovery.restartReport(uuid).then((res) => {
        expect(res.statusCode).to.equal(200);
      });
      return result;
    });

    it('restartReportWithNoParamFailure', async () => {
      const result = expect(spark.internal.ediscovery.restartReport()).to.be.rejectedWith(Error, 'Invalid parameter(s)');
      return result;
    });
  });
});
