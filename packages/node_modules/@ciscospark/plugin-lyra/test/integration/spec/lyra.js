/**!
 *
 * Copyright (c) 2015-2017 Cisco Systems, Inc. See LICENSE file.
 */

import '../..';

import {assert} from '@ciscospark/test-helper-chai';
import testUsers from '@ciscospark/test-helper-test-users';
import CiscoSpark from '@ciscospark/spark-core';
import {map} from 'lodash';

describe(`plugin-lyra`, () => {
  let spock;

  before(`create users`, () => testUsers.create({count: 1})
    .then((users) => {
      spock = users[0];

      return Promise.all(map(users, (user) => {
        user.spark = new CiscoSpark({
          credentials: {
            authorization: user.token
          }
        });

        return user.spark.device.register();
      }));
    }));

  describe(`#ping()`, () => {
    it(`pings lyra`, () => assert.isFulfilled(spock.spark.lyra.ping()));
  });

  describe(`#getServiceHealth()`, () => {
    it(`returns lyra service health`, () => assert.isFulfilled(spock.spark.lyra.getServiceHealth()));
  });

  describe(`#getBuildInfo()`, () => {
    it(`returns lyra build info`, () => assert.isFulfilled(spock.spark.lyra.getBuildInfo()));
  });
});
