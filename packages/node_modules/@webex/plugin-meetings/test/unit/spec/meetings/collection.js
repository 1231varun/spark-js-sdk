/*!
 * Copyright (c) 2015-2019 Cisco Systems, Inc. See LICENSE file.
 */

import {assert} from '@ciscospark/test-helper-chai';
import MeetingCollection from '@webex/plugin-meetings/src/meetings/collection';
import uuid from 'uuid';

describe('plugin-meetings', () => {
  describe('meetings collection', () => {
    let uuid1;
    let uuid2;
    let meetingCollection;
    beforeEach(() => {
      uuid1 = uuid.v4();
      uuid2 = uuid.v4();
      meetingCollection = new MeetingCollection();
    });
    describe('#set', () => {
      it('should set the meeting', () => {
        assert.equal(Object.keys(meetingCollection.meetings).length, 0);
        meetingCollection.set({id: uuid1});
        assert.equal(Object.keys(meetingCollection.meetings).length, 1);
      });
    });
    describe('#getAll', () => {
      beforeEach(() => {
        meetingCollection.meetings.test = {id: uuid1};
        meetingCollection.meetings.test2 = {id: uuid2};
      });
      it('should get all the meeting', () => {
        assert.equal(Object.keys(meetingCollection.getAll()).length, 2);
        assert.deepEqual(Object.keys(meetingCollection.getAll()), ['test', 'test2']);
      });
      describe('with filters', () => {
        beforeEach(() => {
          meetingCollection.meetings.test = {id: uuid1, active: true};
          meetingCollection.meetings.test2 = {id: uuid2, active: false};
        });
        it('should get all the active meetings', () => {
          assert.equal(Object.keys(meetingCollection.meetings).length, 2);
          assert.deepEqual(Object.keys(meetingCollection.getAll({active: true})), ['test']);
        });
      });
    });
    describe('#getByKey', () => {
      beforeEach(() => {
        meetingCollection.meetings.test = {value: 'test', id: uuid1};
        meetingCollection.meetings.test2 = {value: 'test2', id: uuid2};
      });
      it('should get the meeting by key', () => {
        assert.equal(Object.keys(meetingCollection.meetings).length, 2);
        assert.deepEqual(meetingCollection.getByKey('value', 'test'), {value: 'test', id: uuid1});
      });
    });
  });
});
