/* eslint-disable require-jsdoc */

/* eslint-disable require-jsdoc */

import {StatelessSparkPlugin} from '@ciscospark/spark-core';

import {PARTICIPANT, LOCI, CALL, POST, PUT, LEAVE, MEDIA} from '../constants';

export default class MeetingRequest extends StatelessSparkPlugin {
  joinMeeting(options) {
    const {
      sipUri, deviceUrl, locusUrl, resourceId, correlationId
    } = options;

    let url = '';

    const body = {
      deviceUrl,
      usingResource: resourceId || null,
      correlationId,
      respOnlySdp: true,
      supportsNativeLobby: 1,
      allowMultiDevice: true
    };

    if (locusUrl) {
      url = `${locusUrl}/${PARTICIPANT}`;
    }
    else if (sipUri) {
      url = `${this.spark.internal.device.services.locusServiceUrl}/${LOCI}/${CALL}`;
      body.invitee = {
        address: sipUri
      };
    }

    return this.spark.request({
      method: POST,
      uri: url,
      qs: {alternateRedirect: true}, // for handling locus URL redirections
      body
    });
  }

  leaveMeeting(options) {
    const url = `${options.locusUrl}/${PARTICIPANT}/${options.selfId}/${LEAVE}`;
    const body = {
      deviceUrl: options.deviceUrl,
      usingResource: options.resourceId,
      correlationId: options.correlationId
    };
    return this.request({
      method: PUT,
      uri: url,
      body
    });
  }

  remoteAudioVideoToggle(options) {
    const url = `${options.locusUrl}/${PARTICIPANT}/${options.selfId}/${MEDIA}`;
    const body = {
      deviceUrl: options.deviceUrl,
      usingResource: options.resourceId || null,
      correlationId: options.correlationId,
      respOnlySdp: true,
      localMedias: options.localMedias
    };
    return this.request({
      method: PUT,
      uri: url,
      body
    });
  }
}
