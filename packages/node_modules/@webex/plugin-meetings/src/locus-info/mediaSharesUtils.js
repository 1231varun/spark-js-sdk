import {CONTENT} from '../constants';

const mediaSharesUtils = {};

mediaSharesUtils.parse = (mediaShares) => {
  if (mediaShares) {
    return {
      contentId: mediaSharesUtils.getContentId(mediaShares),
      disposition: mediaSharesUtils.getDisposition(mediaShares)
    };
  }
  return null;
};

mediaSharesUtils.getMediaShares = (oldShare, newShare) => {
  const previous = oldShare;
  const current = newShare && mediaSharesUtils.parse(newShare);
  return {
    previous,
    current
  };
};

mediaSharesUtils.getDisposition = (mediaShares) => {
  const contentFloor = mediaSharesUtils.extractContentFloor(mediaShares);
  return contentFloor ? contentFloor.disposition : null;
};

mediaSharesUtils.extractContent = (mediaShares) => {
  if (!mediaShares || !mediaShares.length) {
    return null;
  }
  const supposed = mediaShares[0];
  if (supposed && supposed.name === CONTENT) {
    return supposed;
  }
  return null;
};

mediaSharesUtils.extractFloor = (content) => {
  if (!content) {
    return null;
  }
  return content.floor;
};

mediaSharesUtils.extractContentFloor = (mediaShares) => {
  const content = mediaSharesUtils.extractContent(mediaShares);
  return mediaSharesUtils.extractFloor(content);
};

mediaSharesUtils.getContentId = (mediaShares) => {
  const contentFloor = mediaSharesUtils.extractContentFloor(mediaShares);
  if (!contentFloor || !contentFloor.beneficiary) {
    return null;
  }
  return contentFloor.beneficiary.id;
};

export default mediaSharesUtils;
