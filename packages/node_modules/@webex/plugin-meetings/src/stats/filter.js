import {Transform} from 'stream';

import StatsTransformer from '../stats/transformer';

/**
 * Reforms the interesting data from an RTCStatsReport into something grokkable
 */
export default class StatsFilter extends Transform {
  /**
   * Tells the Stream we're operating in objectMode
   * @private
   */
  constructor() {
    super({objectMode: true});
  }

  /**
   * Filters out just the interesting part of a RTCStatsReport
   * @param {RTCStatsReport} report
   * @param {*} encoding
   * @param {Function} callback
   * @private
   * @returns {undefined}
   */
  _transform(report, encoding, callback) {
    if (!report) {
      callback();
      return;
    }
    const data = StatsTransformer.transform(report);
    this.push({
      data
    });
    callback();
  }
}
