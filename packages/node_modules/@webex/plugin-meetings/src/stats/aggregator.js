import {keys} from 'lodash';

import {DEFAULT_TRANSFORM_KEYS} from '../constants';

import StatsCalculator from '../stats/calculator';

/**
 * simply adds up the properties from filtered stream data
 */
export default class StatsAggregator {
  /**
   * @private
   * @param {Object} options
   */
  constructor(options = {format: DEFAULT_TRANSFORM_KEYS, summary: {}}) {
    this.summary = options.summary;
    if (keys(options.summary).length === 0) {
      options.format.forEach((key) => {
        this.summary[key] = {};
      });
    }
  }

  setFormat(format) {
    this.clearSummary();
    format.forEach((key) => {
      this.summary[key] = {};
    });
  }

  getSummary() {
    return this.summary;
  }

  clearSummary() {
    delete this.summary;
    this.summary = {};
  }

  aggregate(data) {
    this.summary = StatsCalculator.aggregate(data, this.summary);
  }
}
