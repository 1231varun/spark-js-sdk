import {StatelessSparkPlugin} from '@ciscospark/spark-core';

// TODO: find a better way for creating singleton function
/**
 * @class RechabilityRequest
 */
class RechabilityRequest extends StatelessSparkPlugin {
  /**
   * gets the cluster information
   * @returns {Promise}
   */
getClusters = () => this.request({
  method: 'GET',
  shouldRefreshAccessToken: false,
  api: 'calliopeDiscovery',
  resource: 'clusters'
})
  .then((res) => {
    const {clusters} = res.body;
    console.info(`get clusters successful:${JSON.stringify(clusters)}`);
    return Object.keys(clusters);
  });

  /**
   * gets remote SDP For Clusters
   * @param {Object} localSDPList localSDPs for the cluster
   * @returns {Object}
   */
remoteSDPForClusters = (localSDPList) => this.request({
  method: 'POST',
  shouldRefreshAccessToken: false,
  api: 'calliopeDiscovery',
  resource: 'reachability',
  body: {offers: localSDPList}
})
  .then((res) => {
    console.info('Remote SDPs got succcessfully');
    return res.body;
  });
}

export default RechabilityRequest;
