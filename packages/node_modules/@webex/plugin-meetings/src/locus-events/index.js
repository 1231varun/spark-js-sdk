import {StatelessSparkPlugin} from '@ciscospark/spark-core';

import {MEETINGS, LOCUSEVENT, LOCUS_URL} from '../constants';

import LocusParser from './parser';

/**
 * @class LocusEvents
 */
export default class LocusEvents extends StatelessSparkPlugin {
  namespace = MEETINGS;

  /**
   *
   * @param {Object} attrs
   * @param {Object} options
   */
  constructor(attrs, options) {
    super({}, options);
    this.parser = new LocusParser({}, options);
  }

  /**
   * @param {Object} data
   * @returns {undefined}
   * @memberof LocusEvents
   */
  locusEvent(data) {
    const {eventType} = data;
    console.log('Mercury-Locus-Event', eventType);
    if (eventType === LOCUSEVENT.MESSAGE_ROAP) {
      return;
    }
    const meeting = this.spark.meetings.getMeetingByType(LOCUS_URL, data.locusUrl);
    this.parser.parse(meeting, data);
  }

  /**
   * @returns {undefined}
   * @memberof LocusEvents
   */
  start() {
    this.spark.internal.mercury.on(LOCUSEVENT.LOCUS_MERCURY, (envelope) => {
      this.locusEvent(envelope.data);
    });
  }
}
