machine:
  environment:
    COVERAGE: true
    NODE_ENV: test
    XUNIT: true
    UNIT_ONLY: true
  node:
    version: 4

general:
  artifacts:
    - lerna-debug.log
    - npm-debug.log

dependencies:
  cache_directories:
    - node_modules
    # TODO deploy script should update this list automatically
    # circleci doesn't appear to support cache wildcards
    - packages/node_modules/@ciscospark/bin-sauce-connect/node_modules
    - packages/node_modules/@ciscospark/bin-walk/node_modules
    - packages/node_modules/@ciscospark/common/node_modules
    - packages/node_modules/@ciscospark/example-phone/node_modules
    - packages/node_modules/@ciscospark/helper-html/node_modules
    - packages/node_modules/@ciscospark/http-core/node_modules
    - packages/node_modules/@ciscospark/jsdoctrinetest/node_modules
    - packages/node_modules/@ciscospark/plugin-encryption/node_modules
    - packages/node_modules/@ciscospark/plugin-locus/node_modules
    - packages/node_modules/@ciscospark/plugin-mercury/node_modules
    - packages/node_modules/@ciscospark/plugin-metrics/node_modules
    - packages/node_modules/@ciscospark/plugin-phone/node_modules
    - packages/node_modules/@ciscospark/plugin-user/node_modules
    - packages/node_modules/@ciscospark/plugin-wdm/node_modules
    - packages/node_modules/@ciscospark/spark-core/node_modules
    - packages/node_modules/@ciscospark/torage-adapter-local-storage/node_modules
    - packages/node_modules/@ciscospark/torage-adapter-spec/node_modules
    - packages/node_modules/@ciscospark/test-helper-automation/node_modules
    - packages/node_modules/@ciscospark/test-helper-chai/node_modules
    - packages/node_modules/@ciscospark/test-helper-file/node_modules
    - packages/node_modules/@ciscospark/test-helper-make-local-url/node_modules
    - packages/node_modules/@ciscospark/test-helper-mocha/node_modules
    - packages/node_modules/@ciscospark/test-helper-mock-spark/node_modules
    - packages/node_modules/@ciscospark/test-helper-retry/node_modules
    - packages/node_modules/@ciscospark/test-helper-server/node_modules
    - packages/node_modules/@ciscospark/test-helper-sinon/node_modules
    - packages/node_modules/@ciscospark/test-helper-test-users/node_modules
    - packages/node_modules/@ciscospark/widget-message-meet/node_modules
    - packages/node_modules/@ciscospark/xunit-with-logs/node_modules
    - packages/node_modules/ciscospark/node_modules
    - packages/node_modules/generator-ciscospark/node_modules
  post:
    - npm run bootstrap:
        timeout: 1200 # this step takes a long time with no output in CI environments; bump it to 20 minutes

test:
  pre:
    - npm run depcheck
    - npm run grunt:circle -- build:
        parallel: true
  override:
    - npm run grunt:circle -- static-analysis test:
        parallel: true
